{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "description": "Renovate configuration for community Helm charts - watches offchainlabs/nitro-node Docker images (non-RC only)",
  "extends": ["config:recommended"],
  "enabledManagers": ["regex"],
  "customManagers": [
    {
      "customType": "regex",
      "fileMatch": [
        "(^|/)charts/.+/Chart\\.ya?ml$"
      ],
      "matchStrings": [
        "appVersion:\\s*[\"']?(?<currentValue>v\\d+\\.\\d+\\.\\d+-[0-9a-fA-F]{7})[\"']?"
      ],
      "datasourceTemplate": "docker",
      "depNameTemplate": "offchainlabs/nitro-node",
      "versioningTemplate": "loose"
    }
  ],
  "packageRules": [
    {
      "description": "Update offchainlabs/nitro-node image (excluding RC versions) with chart version bump",
      "matchDatasources": ["docker"],
      "matchPackageNames": ["offchainlabs/nitro-node"],
      "allowedVersions": "/^v\\d+\\.\\d+\\.\\d+-[0-9a-fA-F]{7}$/",
      "groupName": "nitro-node",
      "postUpgradeTasks": {
        "commands": [
          ".github/renovate-update-chart.sh {{{packageFileDir}}}/Chart.yaml {{{newVersion}}}"
        ],
        "fileFilters": ["**/Chart.yaml"],
        "executionMode": "branch"
      },
      "semanticCommits": "enabled",
      "commitMessageTopic": "nitro-node Docker image",
      "commitMessageExtra": "to {{{newVersion}}}",
      "prTitle": "chore: update nitro-node to {{{newVersion}}} across all charts"
    }
  ],
  "allowedCommands": ["^\\.github/renovate-update-chart\\.sh.*"],
  "labels": ["dependencies", "docker", "renovate", "nitro"],
  "prConcurrentLimit": 5,
  "prHourlyLimit": 2
}
